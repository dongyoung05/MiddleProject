<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>


<%@ include file="/view/MypageView.jsp" %>


<style>
.hr{
	border: 1px solid black;
	width: 300px;
	height: 0px;
	margin: 0 auto 50px auto;
}

h3{
	text-align: center;
}

.listBox{
	margin-top: 50px;
}

.listBox table{
	margin: 0 auto;
	width: 800px;
}
</style>

<script type="text/javascript">

$(function(){
	
	// total, room, salon(전체, 객실, 미용)
	$.getMyReserve('room');
	
	$('select[name=type]').on('change', function(){
		$.getMyReserve($(this).val());
	})
	
	$(document).on('click', '.cancel', function(){
		
		reserveNo = $(this).parents('.tr').find('.no').text();
		console.log(reserveNo);
		
		if(confirm("정말 취소하겠습니까?")){
			$.getJSON(
				"<%=request.getContextPath()%>/reserve/cancelReserve.do",
				{'reserveNo' : reserveNo},
				function(res){
					if(res.flag = '성공'){
						alert('예약이 취소 되었습니다.');
					}
				}
			)
		}
	})
	
	$(window).resize(function(){$.resize()});
})

$.resize = function(){
	size = $('.listBox').height() + 500;
	console.log(size);
	$('#section').css('height', size);
}

$.getMyReserve = function(type){
	
	if(type == 'room') $('.thname').text('객실이름');
	else $('.thname').text('미용이름');
	
	$.getJSON(
		"<%=request.getContextPath()%>/reserve/myReserve.do",
		{
			'memId' : '<%= memberVo.getMem_id()%>', 
			'type' : type
		},
		function(res){
			
			$('.tr').remove();
			
			$.each(res.newList, function(i,v){
				console.log(v.no);
				let code = "<tr class='tr'><td class='no'>" + v.no +"</td>" +
						"<td>" + v.rin.substr(0, 16) + "<br> ~ " 
						+ v.rout.substr(0, 16) + "</td>" +
						"<td>" + v.name +"</td>" +
						"<td>" + v.dogName +"</td>" +
						"<td>" + v.when.substr(0, 16) +"</td>" +
						"<td><button class='cancel'>취소</button></td></tr>";
				$('#newtb').append(code);		
			})
			$.each(res.oldList, function(i,v){
				console.log(v.no);
				let code = "<tr class='tr'><td class='no'>" + v.no +"</td>" +
						"<td>" + v.rin.substr(0, 16) + "<br> ~ " 
						+ v.rout.substr(0, 16) + "</td>" +
						"<td>" + v.name +"</td>" +
						"<td>" + v.dogName +"</td>" +
						"<td>" + v.when.substr(0, 16) +"</td>" +
						"<td><button class='review'>리뷰</button></td></tr>";
				$('#oldtb').append(code);
			})
			
			$.resize();
		}
	)
}
</script>

<body>


<div id="section">
	
	<select name="type">
		<option value="room">==== 객실 ====</option>
		<option value="salon">==== 미용 ====</option>
	</select>
	
	<div id="new" class="listBox">
		<h3>현재 예약 내역</h3>
		<div class="hr" style="margin-bottom: 50px;"></div>
		
		<table id="newtb" border="1">
			<tr>
				<th>예약번호</th>
				<th>날짜</th>
				<th class="thname">객실이름</th>
				<th>반려견</th>
				<th>예약한날짜</th>
				<th></th>
			</tr>
		</table>
	</div>


	<div id="old" class="listBox">
		<h3>지난 예약 내역</h3>
		<div class="hr" style="margin-bottom: 50px;"></div>
		
		<table id="oldtb" border="1">
			<tr>
				<th>예약번호</th>
				<th>날짜</th>
				<th class="thname">객실이름</th>
				<th>반려견</th>
				<th>예약한날짜</th>
				<th></th>
			</tr>
		</table>
	</div>

</div>


<footer>
	<div class = "foo_div">
		<span>(주)퍼피랑</span> <span>  |  </span>
		<span>대표 : 백지열</span> <span>  |  </span>
		<span>사업자등록번호 : 567-89-10112</span> <span>  |  </span> <br>
		<span>주소 : 대전 중구 계룡로 846 3층</span> <br>
		<span>TEL : 042-222-8202 &nbsp&nbsp&nbsp&nbsp FAX : 042-222-8202</span> <br>
		<span>MAIL : ddit@gmail.com</span>
	</div>
</footer>





</body>
</html>