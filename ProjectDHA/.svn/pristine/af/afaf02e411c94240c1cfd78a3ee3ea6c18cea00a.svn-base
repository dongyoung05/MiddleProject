<?xml version="1.0" encoding="UTF-8"?>
<!-- 이 문서는 myBatis에서 처리할 SQL문을 작성하는 문서입니다. -->
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<!-- 
	<mapper> 태그의 namespace속성에 설정되는 값은 Java에서
	SQL문을 호출할 때 같이 사용되는 이름이다.
	
 -->	
<mapper namespace="Member">
	
	<!-- 회원 전체 목록 조회 -->
	<select id="selectMemberList" resultType="MemberVo">
		select * 
		  from member
		 where mem_delyn='N' 
	</select>
	
	<!-- 특정 회원의 정보 조회 -->	
	<select id="selectGetMemberId" resultType="MemberVo" parameterType="string">
		select * 
		  from member
		 where mem_id = #{mem_id}
		   and mem_delyn='N' 
	</select>	
	
	<!-- 회원의 정보수정 -->
	<update id="updateMember" parameterType="MemberVo">
		update member
		   set mem_name = #{mem_name}
             , mem_pass = #{mem_pass}
             , mem_email = #{mem_email}
             , mem_tel = #{mem_tel}  
             , mem_zip = #{mem_zip}
             , mem_add1 = #{mem_add1}
             , mem_add2 = #{mem_add2}
             , mem_bir = #{mem_bir}
             , mem_img = #{mem_img}
         where mem_id = #{mem_id}  
	</update>	
		
	<!-- 회원 추가 -->
	<insert id="insertMember" parameterType="MemberVo">
		insert into member (mem_id, mem_name, mem_pass, mem_email, mem_tel, mem_zip, mem_add1, mem_add2, mem_bir, mem_img)
		values (#{mem_id}, #{mem_name}, #{mem_pass}, #{mem_email}, #{mem_tel}, #{mem_zip}, #{mem_add1}, #{mem_add2}, #{mem_bir}, #{mem_img})
	</insert>
	
	<!-- 회원 삭제 -->	
	<update id="delMember" parameterType="string">
		update member 
		   set mem_delyn = 'Y'
		 where mem_id = #{mem_id}  
	</update>
	
	<!-- ID중복체크 -->
	<select id="checkMemberId" parameterType="string" resultType="int">
			select count(*) cnt from member where mem_id = #{mem_id}
	</select>
	
	<!-- 로그인처리 -->
	<select id="loginMember" parameterType="MemberVo" resultType="MemberVo">
		select * 
		  from member
		 where mem_id=#{mem_id} and mem_pass=#{mem_pass} and mem_delyn='N'
	</select>
	
	<!-- id 찾기 -->
	<select id="findId" resultType="string" parameterType="MemberVo">
		select mem_id
		  from member
	     where mem_email = #{mem_email}
		   and mem_name = #{mem_name}
	</select>
	
	<!-- 비밀번호 찾기 -->
	<select id="findPass" resultType="MemberVo" parameterType="MemberVo">
		select *
		  from member
		 where mem_id = #{mem_id}
		   and mem_name = #{mem_name}
		   and mem_email = #{mem_email} 
	</select>
	
	<!-- 로그인에 성공한 회원이 블랙리스트인지 판별하기 -->
	<select id="blacklistLogin" parameterType="String" resultType="MemberVo">
		select *
  		  from member a, (select mem_id memId
          		               , count(*) cnt
                            from blacklist
                   	       group by mem_id) b
         where a.mem_id = b.memId
   		   and b.cnt >= '5'
   		   and a.mem_id = #{mem_id}
	</select>
	
	<!-- 블랙리스트 회원목록 조회하기 -->
	<select id="blackMemberList" resultType="MemberVo">
		select *
		  from blacklist
	</select>
	
	<!-- 블랙리스트 회원 조회하기-->
	<select id="blackListSelect" parameterType="string" resultType="MemberVo">
		select *
		  from blacklist
		 where mem_id=#{mem_id}
	</select>
	
	<!-- 블랙리스트 추가하기 -->
	<insert id="blackMemberInsert" parameterType="MemberVo">
		insert into blacklist (report_no, mem_name, mem_email, list_reason, list_date, report_id, mem_id)
		               values ((select count(report_no)+1 cnt 
                                  from blacklist), #{mem_name}, #{mem_email}, #{list_reason}, sysdate, #{report_id}, #{mem_id})
	</insert>	
	
	<!-- 블랙리스트 삭제하기 -->
	<delete id="blackMemberDelete" parameterType="string">
		delete from blacklist
		 where mem_id = #{mem_id}		  
	</delete>
	
</mapper>	